// mingo.js 2.1.1
// Copyright (c) 2018 Francis Asante
// MIT
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.mingo=t()}(this,function(){"use strict";function n(n,t){b(n)&&w(t)}function t(n){switch(u(n)){case Zn:case nt:return N(n,t);default:return n}}function r(n){switch(u(n)){case Zn:return U([],n);case nt:return Object.assign({},n);default:return n}}function e(n){return null===n?"Null":void 0===n?"Undefined":n.constructor.name}function u(n){return e(n).toLowerCase()}function i(n){return u(n)===Hn}function o(n){return u(n)===Kn}function a(n){return u(n)===Xn}function s(n){return u(n)===Zn}function c(n){return!d(n)&&O(n,"length")}function f(n){return u(n)===nt}function l(n){return n===Object(n)}function v(n){return u(n)===Qn}function h(n){return u(n)===Gn}function p(n){return u(n)===tt}function d(n){return $(n)||g(n)}function $(n){return u(n)===Yn}function g(n){return u(n)===zn}function m(n,t){return n.some(T.bind(null,t))}function y(n,t){return!m(n,t)}function _(n){return!!n}function b(n){return!n}function x(n){return d(n)||s(n)&&0===n.length||f(n)&&0===M(n).length||!n}function k(n){return s(n)?n:[n]}function O(n,t){return n.hasOwnProperty(t)}function w(n){throw new Error(n)}function M(n){return Object.keys(n)}function j(t,r){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n(t===Object(t),"Cannot iterate over object of type '"+u(t)+"'"),c(t))for(var i=0,o=t.length;i<o&&r.call(e,t[i],i,t)!==!1;i++);else for(var a in t)if(O(t,a)&&r.call(e,t[a],a,t)===!1)break}function N(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(s(n))return n.map(t,r);if(f(n)){var e={};return j(n,function(n,u){e[u]=t.call(r,n,u)},n),e}}function A(n,t,r){return s(n)?n.reduce(t,r):(j(n,function(e,u){return r=t(r,e,u,n)}),r)}function E(n,t){return n.filter(m.bind(null,t))}function I(n,t){return U(U([],n),t.filter(y.bind(null,n)))}function S(t){function r(n,t){for(var e=0,i=n.length;e<i;e++)s(n[e])&&(t>0||t<0)?r(n[e],Math.max(-1,t-1)):u.push(n[e])}var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;n(s(t),"Input must be an Array");var u=[];return r(t,e),u}function D(n,t){if(t<1)return n;for(;t--&&s(n)&&1===n.length;)n=n[0];return n}function T(n,t){for(var r=[n],e=[t];r.length>0;)if(n=r.pop(),t=e.pop(),n!==t){var i=u(n);if(i!==u(t)||i===tt)return!1;switch(i){case Zn:if(n.length!==t.length)return!1;U(r,n),U(e,t);break;case nt:var o=M(n),a=M(t);if(o.length!==a.length)return!1;o.sort(),a.sort();for(var s=0,c=o.length;s<c;s++){var f=o[s];if(f!==a[s])return!1;r.push(n[f]),e.push(t[f])}break;default:if(q(n)!==q(t))return!1}}return 0===r.length}function P(n){var t={},r=[];return j(n,function(n){var e=C(n);O(t,e)||(r.push(n),t[e]=0)}),r}function q(n){var t=u(n);switch(t){case Hn:case Xn:case Gn:return n.toString();case Kn:return JSON.stringify(n);case Qn:return n.toISOString();case Yn:case zn:return t;case Zn:return"["+N(n,q)+"]";default:var r=t===nt?"":""+e(n),i=M(n);return i.sort(),r+"{"+N(i,function(t){return q(t)+":"+q(n[t])})+"}"}}function C(n){for(var t=0,r=q(n),e=r.length;e;)t=(t<<5)-t^r.charCodeAt(--e);return t>>>0}function L(n,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e={},u=[],i=n.length,o=[],a=0;a<i;a++){var s=n[a],c=t.call(r,s,a);if(d(c))o.push(s);else{var f=C(s);O(e,f)||(e[f]=[c,a]),u.push(s)}}return u.sort(function(n,t){var r=e[C(n)],u=e[C(t)];return r[0]<u[0]?-1:r[0]>u[0]?1:r[1]<u[1]?-1:r[1]>u[1]?1:0}),U(o,u)}function R(n,t,r){var e={keys:[],groups:[]},u={};return j(n,function(n){var i=t.call(r,n),o=C(i),a=-1;g(u[o])&&(a=e.keys.length,u[o]=a,e.keys.push(i),e.groups.push([])),a=u[o],e.groups[a].push(n)}),e}function U(n,t){return Array.prototype.push.apply(n,t),n}function B(n,t){for(var r=0,e=n.length-1;r<=e;){var u=Math.round(r+(e-r)/2);if(t<n[u])e=u-1;else{if(!(t>n[u]))return u;r=u+1}}return r}function F(n){var t=this;return function(r){return function(){for(var e=arguments.length,u=Array(e),i=0;i<e;i++)u[i]=arguments[i];var o=C(u);return O(r,o)||(r[o]=n.apply(t,u)),r[o]}}({})}function V(n,r){var e=M(r);return 0===e.length?n:n.map(function(n){var u=t(n);return j(e,function(t){var e=Rn(n,r[t]);qn(u,t,e)}),u})}function Y(n,t){return new lt(n,t)}function z(n){return function(n){var t=n.length,r=0;return{next:function(){return r<t?{value:n[r++],done:!1}:{done:!0}}}}(n)}function J(t,r){var u=r.boundaries,i=r["default"],o=u[0],a=u[u.length-1],s=r.output||{count:{$sum:1}};n(u.length>2,"$bucket 'boundaries' expression must have at least 3 elements");for(var c=e(o),f=0,l=u.length-1;f<l;f++)n(c===e(u[f+1]),"$bucket 'boundaries' must all be of the same type"),n(u[f]<u[f+1],"$bucket 'boundaries' must be sorted in ascending order");!d(i)&&e(r["default"])===e(o)&&n(o>r["default"]||a<r["default"],"$bucket 'default' expression must be out of boundaries range");var v={};return j(u,function(n){return v[n]=[]}),d(i)||(v[i]=[]),Y.transform(t,function(t){return j(t,function(t){var e=Rn(t,r.groupBy);if(d(e)||e<o||e>=a)n(!d(i),"$bucket require a default for out of range values"),v[i].push(t);else{n(e>=o&&e<a,"$bucket 'groupBy' expression must resolve to a value in range of boundaries");var s=B(u,e),c=u[Math.max(0,s-1)];v[c].push(t)}}),u.pop(),d(i)||u.push(i),u=new Y(u),u.map(function(n){var t=Sn(v[n],null,s);return Object.assign(t,{_id:n})})})}function H(t,r){var e=r.output||{count:{$sum:1}},u=r.groupBy,i=r.buckets;return n(i>0,"The $bucketAuto 'buckets' field must be greater than 0, but found: "+i),Y.transform(t,function(n){for(var t=Math.max(1,Math.round(n.length/i)),r=F(Rn),o={},a=[],s=L(n,function(n){var t=r(n,u);return d(t)?a.push(n):(o[t]||(o[t]=[]),o[t].push(n)),t}),c=En(),f=[],l=0,v=0,h=s.length;v<i&&l<h;v++){for(var p={},$=[],g=0;g<t&&l<h;g++){var m=r(s[l],u);if(d(m)&&(m=null),U($,d(m)?a:o[m]),l+=d(m)?a.length:o[m].length,O(p,"min")||(p.min=m),f.length>0){var y=f[f.length-1];y[c].max=p.min}}v==i-1&&U($,s.slice(l)),f.push(Object.assign(Sn($,null,e),{_id:p}))}return f.length>0&&(f[f.length-1][c].max=r(s[s.length-1],u)),f})}function X(t,r){n(o(r)&&""!==r.trim()&&r.indexOf(".")===-1&&"$"!==r.trim()[0],"Invalid expression value for $count");var e={};return e[r]=0,t.reduce(function(n,t){return n[r]+=1,n},e).one()}function K(n,t){return Y.transform(n,function(n){return N(t,function(t){return fn(n,t)})}).one()}function Q(n,t){var r=En(),e=t[r];return Y.transform(n,function(n){var u=R(n,function(n){return Rn(n,e,e)});delete t[r];var i=0,o=u.keys.length;return function(){if(i===o)return Y.done();var n=u.keys[i],e={};return g(n)||(e[r]=n),j(t,function(n,t){e[t]=Sn(u.groups[i],t,n)}),i++,Y.value(e)}})}function W(n,t){return n.take(t)}function G(t,e){function u(n){return C(d(n)?null:n)}var i=e.from,a=e.localField,c=e.foreignField,f=e.as;n(s(i)&&o(c)&&o(a)&&o(f),"$lookup: invalid argument");var l={};return j(i,function(n){var t=u(n[c]);l[t]=l[t]||[],l[t].push(n)}),t.map(function(n){var t=u(n[a]),e=r(n);return e[f]=l[t]||[],e})}function Z(n,t){var r=new yt(t);return n.filter(function(n){return r.test(n)})}function nn(t,r){return n(s(r),"$out: argument must be an array"),t.map(function(n){return r.push(n),n})}function tn(r,e){if(x(e))return r;var u=M(e),i=!1,s=En(),c=[!1,!1];if(j(e,function(t,r){r!==s&&(0===t||t===!1?c[0]=!0:c[1]=!0,n(c[0]!==c[1],"Projection cannot have a mix of inclusion and exclusion."))}),m(u,s)){var l=e[s];0!==l&&l!==!1||(u=u.filter(y.bind(null,[s])),n(y(u,s),"Must not contain collections id key"),i=x(u))}else u.push(s);return r.map(function(n){var r={},c=!1,l=!1,v=[];return i&&v.push(s),j(u,function(t){var u=e[t],i=void 0;if(t!==s&&m([0,!1],u)&&(l=!0),t===s&&x(u))i=n[t];else if(o(u))i=Rn(n,u,t);else if(m([1,!0],u));else{if(!f(u))return void v.push(t);var h=M(u);h=!(h.length>1)&&h[0],m(jn(ot),h)?"$slice"===h?k(u[h]).every(a)?(i=vt[h](n,u[h],t),c=!0):i=Rn(n,u,t):i=vt[h](n,u[h],t):i=Rn(n,u,t)}var p=Tn(n,t);g(p)||Object.assign(r,p),y([0,1,!1,!0],u)&&(g(i)?Cn(r,t):qn(r,t,i))}),(c||l||i)&&(r=Object.assign({},n,r),v.length>0&&(r=t(r),j(v,function(n){return Cn(r,n)}))),r})}function rn(n,r){return n.map(function(n){return Fn(t(n),r)})}function en(t,r){return t.map(function(t){return t=Rn(t,r.newRoot),n(f(t),"$replaceRoot expression must return an object"),t})}function un(t,r){var e=r.size;return n(a(e),"$sample size must be a positive integer"),Y.transform(t,function(n){var t=n.length,r=0;return function(){if(r++===e)return Y.done();var u=Math.floor(Math.random()*t);return Y.value(n[u])}})}function on(n,t){return n.skip(t)}function an(n,t){return!x(t)&&f(t)?Y.transform(n,function(n){var r=M(t);return j(r.reverse(),function(r){var e=R(n,function(n){return Dn(n,r)}),u={},i=L(e.keys,function(n,t){return u[n]=t,n});t[r]===-1&&i.reverse(),n=[],j(i,function(t){return U(n,e.groups[u[t]])})}),n}):n}function sn(n,t){var r={count:{$sum:1}};return r[En()]=t,this.$sort(this.$group(n,r),{count:-1})}function cn(n,t){o(t)&&(t={path:t});var e=t.path.substr(1),u=t.includeArrayIndex||!1,i=t.preserveNullAndEmptyArrays||!1,a=function(n,t){return u!==!1&&(n[u]=t),n},c=void 0;return Y(function(){for(var t=function(){if(Y.isIterator(c)){var t=c.next();if(Y.isVal(t))return{v:t}}var u=n.next();if(Y.isDone(u))return{v:Y.done()};if(u=u.value,c=In(u,e),s(c)){if(0===c.length&&i===!0){c=null;var o=r(u);return delete o[e],{v:{value:a(o,null),done:!1}}}c=new Y(c).map(function(n,t){var i=r(u);return i[e]=n,a(i,t)})}else if(!x(c)||i===!0){var f=a(r(u),null);return{v:{value:f,done:!1}}}};;){var u=t();if("object"===("undefined"==typeof u?"undefined":st(u)))return u.v}})}function fn(t,r){return n(s(r),"Aggregation pipeline must be an array"),new pt(r).run(t)}function ln(n,t){return P(this.$push(n,t))}function vn(n,t){var r=this.$push(n,t).filter(a),e=A(r,function(n,t){return n+t},0);return e/(r.length||1)}function hn(n,t){return n.length>0?Rn(n[0],t):void 0}function pn(n,t){return n.length>0?Rn(n[n.length-1],t):void 0}function dn(n,t){return A(this.$push(n,t),function(n,t){return d(n)||t>n?t:n},void 0)}function $n(n,t){return A(this.$push(n,t),function(n,t){return d(n)||t<n?t:n},void 0)}function gn(n,t){return d(t)?n:N(n,function(n){return Rn(n,t)})}function mn(n,t){return Bn({data:this.$push(n,t).filter(a),sampled:!1})}function yn(n,t){return Bn({data:this.$push(n,t).filter(a),sampled:!0})}function _n(n,t){return s(n)?a(t)?n.length*t:A(this.$push(n,t).filter(a),function(n,t){return n+t},0):0}function bn(n,t){return e(n)===e(t)}function xn(n,t,r){return new yt(t).find(n,r)}function kn(n,t){return new yt(t).remove(n)}function On(n,t){return new Array(Math.max(t-String(n).length+1,0)).join("0")+n}function wn(n){if(n<128)return[n];for(var t=n<2048&&1||n<65536&&2||3,r=Et[t-1],e=[(n>>6*t)+r];t>0;)e.push(128|n>>6*--t&63);return e}function Mn(n){for(var t=[],r=0,e=n.length;r<e;r++)t.push(wn(n.codePointAt(r)));return t}function jn(){return A(arguments,function(n,t){return U(n,M(Dt[t]))},[])}function Nn(t,r){var e=r(Vn());n(O(Dt,t),"Invalid operator class "+t);var u=Dt[t];j(e,function(r,e){n(/^\$\w+$/.test(e),"Invalid operator name "+e),n(!O(u,e),e+" already exists for '"+t+"' operators")});var o={};switch(t){case at:j(e,function(t,r){o[r]=function(t,e){return function(u,o){return{test:function(a){var s=Dn(a,u),c=t.call(e,u,s,o);return n(i(c),r+" must return a boolean"),c}}}}(t,e)});break;case ot:j(e,function(n,t){o[t]=function(n,t){return function(r,e,u){var i=Dn(r,u);return n.call(t,u,i,e)}}(n,e)});break;default:j(e,function(n,t){o[t]=function(n,t){return function(){for(var r=arguments.length,e=Array(r),u=0;u<r;u++)e[u]=arguments[u];return n.apply(t,e)}}(n,e)})}Object.assign(Dt[t],o)}function An(n){Object.assign(Tt,n||{})}function En(){return Tt.key}function In(n,t){return l(n)?n[t]:void 0}function Sn(t,r,e){if(m(jn(ut),r))return dt[r](t,e);if(f(e)){var u={};return j(e,function(r,i){if(u[i]=Sn(t,i,e[i]),m(jn(ut),i))return u=u[i],n(1===M(e).length,"Invalid $group expression '"+JSON.stringify(e)+"'"),!1}),u}}function Dn(n,t,r){function e(n,t){for(var r=n,i=0;i<t.length;i++){var o=t[i],a=null===o.match(/^\d+$/);if(a&&s(r)){if(0===i&&u>0)break;u+=1,t=t.slice(i),r=A(r,function(n,r){var u=e(r,t);return void 0!==u&&n.push(u),n},[]);break}if(r=In(r,o),void 0===r)break}return r}var u=0;return r=r||{meta:!1},n=e(n,t.split(".")),r.meta?{result:n,depth:u}:n}function Tn(t,r){var e=r.split("."),u=e[0],i=1===e.length||e.slice(1).join("."),o=null!==u.match(/^\d+$/),a=e.length>1,c=void 0,f=void 0;try{s(t)?o?(c=In(t,u),a&&(c=Tn(c,i)),n(!g(c)),c=[c]):(c=[],j(t,function(n){f=Tn(n,r),void 0!==f&&c.push(f)}),n(c.length>0)):(f=In(t,u),a&&(f=Tn(f,i)),n(void 0!==f),c={},c[u]=f)}catch(l){c=void 0}return c}function Pn(n,t,r){var e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=t.split("."),i=u[0],o=1===u.length||u.slice(1).join(".");if(1===u.length)r(n,i);else if(s(n)&&!/^\d+$/.test(i))j(n,function(n){Pn(n,t,r,e)});else{if(e===!0){var a=O(n,i);a&&!d(n[i])||(n[i]={})}Pn(n[i],o,r,e)}}function qn(n,t,r){Pn(n,t,function(n,t){n[t]=r},!0)}function Cn(n,t){Pn(n,t,function(n,t){s(n)&&/^\d+$/.test(t)?n.splice(parseInt(t),1):f(n)&&delete n[t]})}function Ln(n){if(m(rt,u(n)))return h(n)?{$regex:n}:{$eq:n};if(l(n)){var t=M(n),r=0===E(jn(at),t).length;if(r)return{$eq:n};if(m(t,"$regex")){var e=n.$regex,i=n.$options||"",a="";o(e)&&(a+=e.ignoreCase||i.indexOf("i")>=0?"i":"",a+=e.multiline||i.indexOf("m")>=0?"m":"",a+=e.global||i.indexOf("g")>=0?"g":"",e=new RegExp(e,a)),n.$regex=e,delete n.$options}}return n}function Rn(t,r){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(i.root=i.root||t,m(jn(et),e))return St[e](t,r,i);if(m(jn(ut),e))return t=Rn(t,r,null,i),n(s(t),e+" expression must resolve to an array"),dt[e](t,null,i);if(o(r)&&r.length>0&&"$"===r[0]){if(m(Ct,r))return Pt[r](t,null,i);if(m(Lt,r))return r;var a=Ct.filter(function(n){return 0===r.indexOf(n+".")});return 1===a.length&&(a=a[0],"$$ROOT"===a&&(t=i.root),r=r.substr(a.length)),Dn(t,r.slice(1))}switch(u(r)){case Zn:return r.map(function(n){return Rn(t,n)});case nt:var c={};return j(r,function(e,u){if(c[u]=Rn(t,e,u,i),m(jn(et,ut),u))return n(1===M(r).length,"Invalid aggregation expression '"+JSON.stringify(r)+"'"),c=c[u],!1}),c;default:return r}}function Un(t,r){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return d(e)?r<0?(r=Math.max(0,t.length+r),e=t.length-r+1):(e=r,r=0):(r<0&&(r=Math.max(0,t.length+r)),n(e>0,"Invalid argument value for $slice operator. Limit must be a positive number"),e+=r),t.slice(r,e)}function Bn(n){var t=A(n.data,function(n,t){return n+t},0),r=n.data.length||1,e=n.sampled&&1||0,u=t/r;return Math.sqrt(A(n.data,function(n,t){return n+Math.pow(t-u,2)},0)/(r-e))}function Fn(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r.root=r.root||n;var e=Rn(n,t,null,r);return m(Lt,e)?qt[e](n,t,r):e}function Vn(){return{assert:n,computeValue:Rn,clone:r,cloneDeep:t,each:j,err:w,getHash:C,getType:e,has:O,idKey:En,includes:m.bind(null),isArray:s,isBoolean:i,isDate:v,isEmpty:x,isEqual:T,isFunction:p,isNil:d,isNull:$,isNumber:a,isObject:f,isRegExp:h,isString:o,isUndefined:g,keys:M,map:N,ops:jn,resolve:Dn,resolveObj:Tn,reduce:A}}var Yn="null",zn="undefined",Jn="bool",Hn="boolean",Xn="number",Kn="string",Qn="date",Wn="regex",Gn="regexp",Zn="array",nt="object",tt="function",rt=[Yn,zn,Hn,Xn,Kn,Qn,Gn],et="expression",ut="group",it="pipeline",ot="projection",at="query",st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ct=function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")},ft=function(){function n(n,t){for(var r=0;r<t.length;r++){var e=t[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}return function(t,r,e){return r&&n(t.prototype,r),e&&n(t,e),t}}();Y._identity=function(n){return n},Y._cmp=function(n,t){return n<t?-1:n>t?1:0},Y._isfunction=function(n){return n instanceof Function},Y.isDone=function(n){return!!n&&n.done===!0},Y.isVal=function(n){return!!n&&n.done===!1&&n.hasOwnProperty("value")},Y.done=function(){return{done:!0}},Y.isIterator=function(n){return n instanceof Object&&Y._isfunction(n.next)},Y.value=function(n){return{value:n,done:!1}},Y.transform=function(n,t){return Y(t(Y.all(n)))},Y.all=function(n){if(n instanceof Array)return n;if(!Y.isIterator(n))return[n];for(var t=[];;){var r=n.next();if(Y.isDone(r))break;t.push(r.value)}return t},Y.range=function(n,t,r){return void 0===t&&(t=n,n=0),r||(r=n<t?1:-1),Y({next:function(){if(r>0&&n<t||r<0&&n>t){var e=Y.value(n);return n+=r,e}return Y.done()}})},Y.NEXT=function(){};var lt=function(){function n(t,r){ct(this,n),this.__src=t,this.__fn=r,this.__done=!1,Y._isfunction(t)?this.__src={next:t}:Y.isIterator(t)||t instanceof Array||(t=[t]),t instanceof Array&&(this.__src=z(t))}return ft(n,[{key:Symbol.iterator,value:function(){return this}},{key:"_end",value:function(){this.__done=!0,this.__src=null}},{key:"_source",value:function(){return this.__src}},{key:"all",value:function(){return Y.all(this)}},{key:"next",value:function(){for(;!this.__done;){var n=this.__src.next();if(this.__fn&&!Y.isDone(n)&&(n=this.__fn(n)),n!==Y.NEXT){if(!Y.isDone(n))return n;this._end()}}return Y.done()}},{key:"each",value:function(n){for(;;){var t=this.next();if(Y.isDone(t))break;n(t.value)}}},{key:"map",value:function(n){var t=0;return Y(this,function(r){return r.value=n(r.value,t++),r})}},{key:"filter",value:function(n){return Y(this,function(t){return n(t.value)?t:Y.NEXT})}},{key:"take",value:function(n){if(!Y._isfunction(n)){var t=0,r=n;n=function(n){return r>t++}}return Y(this,function(t){return n(t.value)?t:Y.done()})}},{key:"skip",value:function(n){if(!Y._isfunction(n)){var t=n;n=function(n){return t-- >0}}return Y(this,function(t){return n(t.value)?Y.NEXT:t})}},{key:"reduce",value:function(n,t){var r=this;return Y(function(){var e=r.next();if(Y.isDone(e))return e;for(var u=0;Y.isVal(e);)t=0===u&&void 0===t?e.value:n(t,e.value,u),e=r.next(),u++;return Y.value(t)})}},{key:"sample",value:function(){return this.filter(function(n){return Math.random()>.5})}},{key:"reverse",value:function(){return Y.transform(this,function(n){return n.reverse(),n})}},{key:"sort",value:function(n){return Y.transform(this,function(t){return n=n||Y._cmp,t.sort(n),t})}},{key:"sortBy",value:function(n,t){return Y.transform(this,function(r){return t=t||Y._cmp,r.sort(function(r,e){return t(n(r),n(e))}),r})}},{key:"count",value:function(){return this.reduce(function(n,t){return++n}).all()[0]}},{key:"one",value:function(){var n=this;return{next:function(){return n.next()},all:function(){return n.all()[0]}}}}]),n}(),vt={$:function(n,t,r){w("$ not implemented")},$elemMatch:function(t,r,e){var u=Dn(t,e),i=new yt(r);n(s(u),"$elemMatch: invalid argument");for(var o=0;o<u.length;o++)if(i.test(u[o]))return[u[o]]},$slice:function(t,r,e){var u=Dn(t,e);return s(u)?s(r)?Un(u,r[0],r[1]):(n(a(r),"$slice: invalid arguments for projection"),Un(u,r)):u}},ht={$addFields:V,$bucket:J,$bucketAuto:H,$count:X,$facet:K,$group:Q,$limit:W,$lookup:G,$match:Z,$out:nn,$project:tn,$redact:rn,$replaceRoot:en,$sample:un,$skip:on,$sort:an,$sortByCount:sn,$unwind:cn},pt=function(){function t(n){ct(this,t),this.__operators=n}return ft(t,[{key:"stream",value:function(t,r){return t instanceof Y||(t=new Y(t)),x(this.__operators)||j(this.__operators,function(e){var u=M(e);n(1===u.length&&m(jn(it),u[0]),"Invalid aggregation operator "+u),u=u[0],t=r&&r instanceof yt?ht[u].call(r,t,e[u]):ht[u](t,e[u])}),t}},{key:"run",value:function(n,t){return this.stream(n,t).all()}}]),t}(),dt={$addToSet:ln,$avg:vn,$first:hn,$last:pn,$max:dn,$min:$n,$push:gn,$stdDevPop:mn,$stdDevSamp:yn,$sum:_n},$t=function(){function n(t,r,e){ct(this,n),this.__query=r,this.__source=t,this.__projection=e||r.__projection,this.__operators=[],this.__result=null,this.__stack=[]}return ft(n,[{key:"_fetch",value:function(){var n=this;return this.__result?this.__result:(f(this.__projection)&&this.__operators.push({$project:this.__projection}),this.__result=new Y(this.__source).filter(function(t){return n.__query.test(t)}),this.__operators.length>0&&(this.__result=new pt(this.__operators).stream(this.__result,this.__query)),this.__result)}},{key:"all",value:function(){return this._fetch().all()}},{key:"count",value:function(){return this.all().length}},{key:"skip",value:function(n){return this.__operators.push({$skip:n}),this}},{key:"limit",value:function(n){return this.__operators.push({$limit:n}),this}},{key:"sort",value:function(n){return this.__operators.push({$sort:n}),this}},{key:"next",value:function(){if(this.__stack){if(this.__stack.length>0)return this.__stack.pop();var n=this._fetch().next();return Y.isVal(n)?n.value:void(this.__stack=null)}}},{key:"hasNext",value:function(){if(!this.__stack)return!1;if(this.__stack.length>0)return!0;var n=this._fetch().next();return Y.isVal(n)?this.__stack.push(n.value):this.__stack=null,!!this.__stack}},{key:"map",value:function(n){return this._fetch().map(n).all()}},{key:"forEach",value:function(n){this._fetch().each(n)}},{key:Symbol.iterator,value:function(){return this._fetch()}}]),n}(),gt={$eq:function(n,t){if(T(n,t))return!0;if(d(n)&&d(t))return!0;if(s(n)){var r=T.bind(null,t);return n.some(r)||S(n,1).some(r)}return!1},$ne:function(n,t){return!this.$eq(n,t)},$in:function(n,t){return E(k(n),t).length>0},$nin:function(n,t){return d(n)||!this.$in(n,t)},$lt:function(n,t){return!g(k(n).find(function(n){return bn(n,t)&&n<t}))},$lte:function(n,t){return!g(k(n).find(function(n){return bn(n,t)&&n<=t}))},$gt:function(n,t){return!g(k(n).find(function(n){return bn(n,t)&&n>t}))},$gte:function(n,t){return!g(k(n).find(function(n){return bn(n,t)&&n>=t}))},$mod:function(n,t){return!g(k(n).find(function(n){return a(n)&&s(t)&&2===t.length&&n%t[0]===t[1]}))},$regex:function(n,t){n=k(n);var r=function(n){return o(n)&&!!n.match(t)};return n.some(r)||S(n,1).some(r)},$exists:function(n,t){return(t===!1||0===t)&&d(n)||(t===!0||1===t)&&!d(n)},$all:function(n,t){var r=!1;if(s(n)&&s(t))for(var e=0,u=t.length;e<u;e++){if(!f(t[e])||!m(M(t[e]),"$elemMatch"))return E(t,n).length===u;r=r||this.$elemMatch(n,t[e].$elemMatch)}return r},$size:function(n,t){return s(n)&&a(t)&&n.length===t},$elemMatch:function(n,t){if(s(n)&&!x(n))for(var r=new yt(t),e=0,u=n.length;e<u;e++)if(r.test(n[e]))return!0;return!1},$type:function(n,t){switch(t){case 1:case"double":return a(n)&&(n+"").indexOf(".")!==-1;case 2:case Kn:return o(n);case 3:case nt:return f(n);case 4:case Zn:return s(n);case 6:case zn:return d(n);case 8:case Jn:return i(n);case 9:case Qn:return v(n);case 10:case Yn:return $(n);case 11:case Wn:return h(n);case 16:case"int":return a(n)&&n<=2147483647&&(n+"").indexOf(".")===-1;case 18:case"long":return a(n)&&n>2147483647&&n<=0x8000000000000000&&(n+"").indexOf(".")===-1;case 19:case"decimal":return a(n);default:return!1}}},mt={$and:function(t,r){n(s(r),"Invalid expression: $and expects value to be an Array");var e=[];return j(r,function(n){return e.push(new yt(n))}),{test:function(n){for(var t=0;t<e.length;t++)if(!e[t].test(n))return!1;return!0}}},$or:function(t,r){n(s(r),"Invalid expression. $or expects value to be an Array");var e=[];return j(r,function(n){return e.push(new yt(n))}),{test:function(n){for(var t=0;t<e.length;t++)if(e[t].test(n))return!0;return!1}}},$nor:function(t,r){n(s(r),"Invalid expression. $nor expects value to be an Array");var e=this.$or("$or",r);return{test:function(n){return!e.test(n)}}},$not:function(n,t){var r={};r[n]=Ln(t);var e=new yt(r);return{test:function(n){return!e.test(n)}}},$where:function(n,t){return p(t)||(t=new Function("return "+t+";")),{test:function(n){return t.call(n)===!0}}}};j(gt,function(n,t){mt[t]=function(n,t){return function(r,e){return{test:function(u){var i=Dn(u,r,{meta:!0});return i=D(i.result,i.depth),n.call(t,i,e)}}}}(n,gt)});var yt=function(){function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ct(this,t),this.__criteria=n,this.__projection=r,this.__compiled=[],this._compile()}return ft(t,[{key:"_compile",value:function(){var t=this;if(!x(this.__criteria)){n(f(this.__criteria),"Criteria must be of type Object");var r=void 0;j(this.__criteria,function(n,e){"$where"===e?r={field:e,expr:n}:m(["$and","$or","$nor"],e)?t._processOperator(e,e,n):(n=Ln(n),j(n,function(n,r){t._processOperator(e,r,n)})),f(r)&&t._processOperator(r.field,r.field,r.expr)})}}},{key:"_processOperator",value:function(t,r,e){n(m(jn(at),r),"Invalid query operator '"+r+"' detected"),this.__compiled.push(mt[r](t,e))}},{key:"test",value:function(n){for(var t=0,r=this.__compiled.length;t<r;t++)if(!this.__compiled[t].test(n))return!1;return!0}},{key:"find",value:function(n,t){return new $t(n,this,t)}},{key:"remove",value:function(n){var t=this;return A(n,function(n,r){return t.test(r)||n.push(r),n},[])}}]),t}(),_t={$abs:function(n,t){var r=Rn(n,t);return null===r||void 0===r?null:Math.abs(r)},$add:function(t,r){var e=Rn(t,r),u=!1,i=A(e,function(t,r){return v(r)&&(n(!u,"'$add' can only have one date value"),u=!0,r=r.getTime()),t+=r},0);return u?new Date(i):i},$ceil:function(t,r){var e=Rn(t,r);return d(e)?null:(n(a(e)||isNaN(e),"$ceil must be a valid expression that resolves to a number."),Math.ceil(e))},$divide:function(n,t){var r=Rn(n,t);return r[0]/r[1]},$exp:function(t,r){var e=Rn(t,r);return d(e)?null:(n(a(e)||isNaN(e),"$exp must be a valid expression that resolves to a number."),Math.exp(e))},$floor:function(t,r){var e=Rn(t,r);return d(e)?null:(n(a(e)||isNaN(e),"$floor must be a valid expression that resolves to a number."),Math.floor(e))},$ln:function(t,r){var e=Rn(t,r);return d(e)?null:(n(a(e)||isNaN(e),"$ln must be a valid expression that resolves to a number."),Math.log(e))},$log:function(t,r){var e=Rn(t,r);return n(s(e)&&2===e.length,"$log must be a valid expression that resolves to an array of 2 items"),e.some(d)?null:(n(e.some(isNaN)||e.every(a),"$log expression must resolve to array of 2 numbers"),Math.log10(e[0])/Math.log10(e[1]))},$log10:function(t,r){var e=Rn(t,r);return d(e)?null:(n(a(e)||isNaN(e),"$log10 must be a valid expression that resolves to a number."),Math.log10(e))},$mod:function(n,t){var r=Rn(n,t);return r[0]%r[1]},$multiply:function(n,t){var r=Rn(n,t);return A(r,function(n,t){return n*t},1)},$pow:function(t,r){var e=Rn(t,r);return n(s(e)&&2===e.length&&e.every(a),"$pow expression must resolve to an array of 2 numbers"),n(!(0===e[0]&&e[1]<0),"$pow cannot raise 0 to a negative exponent"),Math.pow(e[0],e[1])},$sqrt:function(t,r){var e=Rn(t,r);return d(e)?null:(n(a(e)&&e>0||isNaN(e),"$sqrt expression must resolve to non-negative number."),Math.sqrt(e))},$subtract:function(n,t){var r=Rn(n,t);return r[0]-r[1]},$trunc:function(t,r){var e=Rn(t,r);return d(e)?null:(n(a(e)||isNaN(e),"$trunc expression must resolve to a number."),Math.trunc(e))}},bt={$arrayElemAt:function(t,r){var e=Rn(t,r);n(s(e)&&2===e.length,"$arrayElemAt expression must resolve to an array of 2 elements"),n(s(e[0]),"First operand to $arrayElemAt must resolve to an array"),n(a(e[1]),"Second operand to $arrayElemAt must resolve to an integer");var u=e[1];return e=e[0],u<0&&Math.abs(u)<=e.length?e[u+e.length]:u>=0&&u<e.length?e[u]:void 0},$arrayToObject:function(t,r){var e=Rn(t,r);return n(s(e),"$arrayToObject expression must resolve to an array"),A(e,function(t,r){return s(r)&&2==r.length?t[r[0]]=r[1]:(n(f(r)&&O(r,"k")&&O(r,"v"),"$arrayToObject expression is invalid."),t[r.k]=r.v),t},{})},$concatArrays:function(t,r){var e=Rn(t,r,null);return n(s(e),"$concatArrays must resolve to an array"),e.some(d)?null:e.reduce(function(n,t){return U(n,t)},[])},$filter:function(t,r){var e=Rn(t,r.input),u=r.as,i=r.cond;return n(s(e),"$filter 'input' expression must resolve to an array"),e.filter(function(n){var t={};return t["$"+u]=n,Rn(t,i)===!0})},$in:function(t,r){var e=Rn(t,r[0]),u=Rn(t,r[1]);return n(s(u),"$in second argument must be an array"),m(u,e)},$indexOfArray:function(t,r){var e=Rn(t,r);if(d(e))return null;var u=e[0],i=e[1];if(d(u))return null;n(s(u),"$indexOfArray expression must resolve to an array.");var o=e[2]||0,a=e[3];return d(a)&&(a=u.length),o>a?-1:(n(o>=0&&a>=0,"$indexOfArray expression is invalid"),(o>0||a<u.length)&&(u=u.slice(o,a)),u.findIndex(T.bind(null,i))+o)},$isArray:function(n,t){return s(Rn(n,t[0]))},$map:function(t,r){var e=Rn(t,r.input);n(s(e),"$map 'input' expression must resolve to an array");var u=r.as,i=r["in"],o="$"+u;return N(e,function(n){return t[o]=n,Rn(t,i)})},$objectToArray:function(t,r){var e=Rn(t,r);n(f(e),"$objectToArray expression must resolve to an object");var u=[];return j(e,function(n,t){return u.push({k:t,v:n})}),u},$range:function(n,t){for(var r=Rn(n,t),e=r[0],u=r[1],i=r[2]||1,o=[];e<u&&i>0||e>u&&i<0;)o.push(e),e+=i;return o},$reduce:function(t,r){var e=Rn(t,r.input),u=Rn(t,r.initialValue),i=r["in"];return d(e)?null:(n(s(e),"$reduce 'input' expression must resolve to an array"),A(e,function(n,t){return Rn({$value:n,$this:t},i)},u))},$reverseArray:function(t,r){var e=Rn(t,r);if(d(e))return null;n(s(e),"$reverseArray expression must resolve to an array");var u=[];return U(u,e),u.reverse(),u},$size:function(n,t){var r=Rn(n,t);return s(r)?r.length:void 0},$slice:function(n,t){var r=Rn(n,t);return Un(r[0],r[1],r[2])},$zip:function(t,r){var e=Rn(t,r.inputs),u=r.useLongestLength||!1;n(s(e),"'inputs' expression must resolve to an array"),n(i(u),"'useLongestLength' must be a boolean"),s(r.defaults)&&n(_(u),"'useLongestLength' must be set to true to use 'defaults'");for(var o=0,a=0,c=e.length;a<c;a++){var f=e[a];if(d(f))return null;n(s(f),"'inputs' expression values must resolve to an array or null"),o=u?Math.max(o,f.length):Math.min(o||f.length,f.length)}for(var l=[],v=r.defaults||[],h=function(n){var t=e.map(function(t,r){return d(t[n])?v[r]||null:t[n]});l.push(t)},p=0;p<o;p++)h(p);return l}},xt={$and:function(n,t){var r=Rn(n,t);return _(r)&&r.every(_)},$or:function(n,t){var r=Rn(n,t);return _(r)&&r.some(_)},$not:function(n,t){return!Rn(n,t[0])}},kt={$cmp:function(n,t){var r=Rn(n,t);return r[0]>r[1]?1:r[0]<r[1]?-1:0}};j(["$eq","$ne","$gt","$gte","$lt","$lte","$nin"],function(n){kt[n]=function(t,r){var e=Rn(t,r);return gt[n](e[0],e[1])}});var Ot={$cond:function(t,r){var e=void 0,u=void 0,i=void 0,o="$cond: invalid arguments";s(r)?(n(3===r.length,o),e=r[0],u=r[1],i=r[2]):(n(f(r),o),e=r["if"],u=r.then,i=r["else"]);var a=Rn(t,e);return a?Rn(t,u):Rn(t,i)},$switch:function(t,r){var e="Invalid arguments for $switch operator";n(r.branches,e);var u=r.branches.find(function(r){return n(r["case"]&&r.then,e),Rn(t,r["case"])});return u?Rn(t,u.then):(n(r["default"],e),Rn(t,r["default"]))},$ifNull:function(t,r){n(s(r)&&2===r.length,"Invalid arguments for $ifNull operator");var e=Rn(t,r);return d(e[0])?e[1]:e[0]}},wt={"%Y":["$year",4],"%m":["$month",2],"%d":["$dayOfMonth",2],"%H":["$hour",2],"%M":["$minute",2],"%S":["$second",2],"%L":["$millisecond",3],"%j":["$dayOfYear",3],"%w":["$dayOfWeek",1],"%U":["$week",2],"%%":"%"},Mt={$dayOfYear:function(n,t){var r=Rn(n,t),e=new Date(r.getFullYear(),0,0),u=r-e,i=864e5;return Math.round(u/i)},$dayOfMonth:function(n,t){var r=Rn(n,t);return r.getDate()},$dayOfWeek:function(n,t){var r=Rn(n,t);return r.getDay()+1},$year:function(n,t){var r=Rn(n,t);return r.getFullYear()},$month:function(n,t){var r=Rn(n,t);return r.getMonth()+1},$week:function(n,t){var r=Rn(n,t);r=new Date((+r)),r.setHours(0,0,0),r.setDate(r.getDate()+4-(r.getDay()||7));var e=new Date(r.getFullYear(),0,1);return Math.floor(((r-e)/864e5+1)/7)},$hour:function(n,t){var r=Rn(n,t);return r.getUTCHours()},$minute:function(n,t){var r=Rn(n,t);return r.getMinutes()},$second:function(n,t){var r=Rn(n,t);return r.getSeconds()},$millisecond:function(n,t){var r=Rn(n,t);return r.getMilliseconds()},$dateToString:function(n,t){for(var r=t.format,e=Rn(n,t.date),u=r.match(/(%%|%Y|%m|%d|%H|%M|%S|%L|%j|%w|%U)/g),i=0,o=u.length;i<o;i++){var a=wt[u[i]],c=a;if(s(a)){var f=this[a[0]],l=a[1];c=On(f.call(this,n,e),l);
}r=r.replace(u[i],c)}return r}},jt={$literal:function(n,t){return t}},Nt={$setEquals:function(n,t){var r=Rn(n,t),e=P(r[0]),u=P(r[1]);return e.length===u.length&&e.length===E(e,u).length},$setIntersection:function(n,t){var r=Rn(n,t);return E(r[0],r[1])},$setDifference:function(n,t){var r=Rn(n,t);return r[0].filter(y.bind(null,r[1]))},$setUnion:function(n,t){var r=Rn(n,t);return I(r[0],r[1])},$setIsSubset:function(n,t){var r=Rn(n,t);return E(r[0],r[1]).length===r[0].length},$anyElementTrue:function(n,t){var r=Rn(n,t)[0];return r.some(_)},$allElementsTrue:function(n,t){var r=Rn(n,t)[0];return r.every(_)}},At={$concat:function(n,t){var r=Rn(n,t);return[null,void 0].some(m.bind(null,r))?null:r.join("")},$indexOfBytes:function(t,r){var e=Rn(t,r),u="$indexOfBytes: expression resolves to invalid arguments";if(d(e[0]))return null;n(o(e[0])&&o(e[1]),u);var i=e[0],s=e[1],c=e[2],f=e[3],l=d(c)||a(c)&&c>=0&&Math.round(c)===c;if(l=l&&(d(f)||a(f)&&f>=0&&Math.round(f)===f),n(l,u),c=c||0,f=f||i.length,c>f)return-1;var v=i.substring(c,f).indexOf(s);return v>-1?v+c:v},$split:function(t,r){var e=Rn(t,r);return d(e[0])?null:(n(e.every(o),"$split: invalid argument"),e[0].split(e[1]))},$strLenBytes:function(n,t){return~-encodeURI(Rn(n,t)).split(/%..|./).length},$strLenCP:function(n,t){return Rn(n,t).length},$strcasecmp:function(t,r){var e=Rn(t,r),u=e[0],i=e[1];return T(u,i)||e.every(d)?0:(n(e.every(o),"$strcasecmp: invalid argument"),u=u.toUpperCase(),i=i.toUpperCase(),u>i&&1||u<i&&-1||0)},$substrBytes:function(t,r){var e=Rn(t,r),u=e[0],i=e[1],s=e[2];n(o(u)&&a(i)&&i>=0&&a(s)&&s>=0,"$substrBytes: invalid arguments");for(var c=Mn(u),f=[],l=0,v=0;v<c.length;v++)f.push(l),l+=c[v].length;var h=f.indexOf(i),p=f.indexOf(i+s);return n(h>-1&&p>-1,"$substrBytes: Invalid range, start or end index is a UTF-8 continuation byte."),u.substring(h,p)},$substr:function(n,t){var r=Rn(n,t),e=r[0],u=r[1],i=r[2];return o(e)?u<0?"":i<0?e.substr(u):e.substr(u,i):""},$substrCP:function(n,t){return this.$substr(n,t)},$toLower:function(n,t){var r=Rn(n,t);return x(r)?"":r.toLowerCase()},$toUpper:function(n,t){var r=Rn(n,t);return x(r)?"":r.toUpperCase()}},Et=[192,224,240],It={$let:function(n,t){var r=t.vars,e=t["in"],u=M(r);return j(u,function(t){var e=Rn(n,r[t]),u="$"+t;n[u]=e}),Rn(n,e)}},St=Object.assign({},_t,bt,xt,kt,Ot,Mt,jt,Nt,At,It),Dt={expression:St,group:dt,pipeline:ht,projection:vt,query:mt},Tt={key:"_id"},Pt={$$ROOT:function(n,t,r){return r.root},$$CURRENT:function(n,t,r){return n}},qt={$$KEEP:function(n){return n},$$PRUNE:function(){},$$DESCEND:function(n,t,r){if(!O(t,"$cond"))return n;var e=void 0;return j(n,function(u,i){l(u)&&(s(u)?(e=[],j(u,function(n){f(n)&&(n=Fn(n,t,r)),d(n)||e.push(n)})):e=Fn(u,t,r),d(e)?delete n[i]:n[i]=e)}),n}},Ct=M(Pt),Lt=M(qt),Rt={query:function(n,t){return new yt(n).find(this.toJSON(),t)},aggregate:function(n){return new pt(n).run(this.toJSON())}},Ut="2.1.1",Bt={_internal:Vn,Aggregator:pt,CollectionMixin:Rt,Cursor:$t,Lazy:Y,OP_EXPRESSION:et,OP_GROUP:ut,OP_PIPELINE:it,OP_PROJECTION:ot,OP_QUERY:at,Query:yt,VERSION:Ut,addOperators:Nn,aggregate:fn,find:xn,remove:kn,setup:An};return Bt});
//# sourceMappingURL=dist/mingo.min.map
